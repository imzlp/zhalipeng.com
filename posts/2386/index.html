<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-32x32-tilt-brush.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-tilt-brush.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-tilt-brush.png">
  <link rel="mask-icon" href="/images/favicon-32x32-tilt-brush.png" color="#222">
  <meta name="google-site-verification" content="ttIkhAIFZQM9Huj8roB0l95ePN2Tv2zv2wRFksi09WA">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Pacifico:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"imzlp.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false,"width":280},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"manual"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":true,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="UE4中提供了一套非常成熟的INI文件配置机制，引擎中也使用了ini作为引擎和项目的配置文件。本篇文章来简单分析一下引擎中GConfig的加载。">
<meta property="og:type" content="article">
<meta property="og:title" content="UE代码分析:GConfig的加载">
<meta property="og:url" content="https://imzlp.com/posts/2386/index.html">
<meta property="og:site_name" content="Z&#39;s Blog">
<meta property="og:description" content="UE4中提供了一套非常成熟的INI文件配置机制，引擎中也使用了ini作为引擎和项目的配置文件。本篇文章来简单分析一下引擎中GConfig的加载。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://imzlp.com/posts/2386/ue4-gather-ini-source-ini-hierachy.webp">
<meta property="og:image" content="https://imzlp.com/posts/2386/ue-pass-custom-globalconfig-by-commandline.webp">
<meta property="og:image" content="https://imzlp.com/posts/2386/ue-pass-custom-globalconfig-by-commandline-2.webp">
<meta property="article:published_time" content="2019-05-27T22:57:58.000Z">
<meta property="article:modified_time" content="2020-05-28T18:02:53.000Z">
<meta property="article:author" content="查利鹏">
<meta property="article:tag" content="Unreal Engine">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://imzlp.com/posts/2386/ue4-gather-ini-source-ini-hierachy.webp">

<link rel="canonical" href="https://imzlp.com/posts/2386/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>UE代码分析:GConfig的加载 | Z's Blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66450323-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-66450323-1');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Z's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">循迹研究室</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        
            
  <li class="menu-item menu-item-notes">

    <a href="/notes/" rel="section"><i class="fa fa-edit fa-fw"></i>笔记</a>

  </li>


      
        
            
  <li class="menu-item menu-item-essay">

    <a href="/essay/" rel="section"><i class="fas fa-feather-alt fa-fw"></i>随笔</a>

  </li>


      
        <li class="menu-item menu-item-feeds">

    <a href="/feeds/" rel="section"><i class="fas fa-rss fa-fw"></i>资讯</a>

  </li>
        
            
  <li class="menu-item menu-item-resources">

    <a href="/resources/" rel="section"><i class="fa fa-inbox fa-fw"></i>资源</a>

  </li>


      
        <li class="menu-item menu-item-friends">

    <a href="/friends/" rel="section"><i class="fas fa-link fa-fw"></i>友链</a>

  </li>
        
            
  <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>


      
        <li class="menu-item menu-item-links">

    <a href="/links/" rel="section"><i class="fas fa-sitemap fa-fw"></i>站点地图</a>

  </li>
        <li class="menu-item menu-item-changelog">

    <a href="/changelog/" rel="section"><i class="fa fa-history fa-fw"></i>站点日志</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>站内搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

  <div id="google_translate_element"></div>
  <script type="text/javascript">
    function googleTranslateElementInit()
    {
      var google_translate_element = document.getElementById('google_translate_element');
      var timer = setInterval(function() 
      {
        google_translate_element = document.getElementById('google_translate_element');
        if (google_translate_element) 
        {
          clearInterval(timer);
          new google.translate.TranslateElement(
          {
            pageLanguage: 'zh-CN',
            
              includedLanguages: 'en,zh-CN,ru,ja',
            
            layout: google.translate.TranslateElement.InlineLayout.SIMPLE, autoDisplay: true
          },
          'google_translate_element');

          
            // 清除图片的请求
            img = [].slice.call(document.querySelectorAll('#goog-gt-tt img,#google_translate_element img'));
            img.forEach(function(v, i) {v.src = '';});
          
          var google_language_selector = document.getElementById(':0.targetLanguage');
          google_language_selector.style.backgroundColor = "#ffffffb5";
          google_language_selector.style.border = "0px solid #ffffffb5";
        }
      }, 300);
    }
  </script>
  <script type="text/javascript" src="//translate.google.cn/translate_a/element.js?cb=googleTranslateElementInit"></script>



</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://imzlp.com/posts/2386/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="查利鹏">
      <meta itemprop="description" content="每一篇文章都是一个成长的过程。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Z's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          UE代码分析:GConfig的加载
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-27 22:57 22:57:58:57" itemprop="dateCreated datePublished" datetime="2019-05-27T22:57:58+00:00">2019-05-27 22:57</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Unreal-Engine/" itemprop="url" rel="index"><span itemprop="name">Unreal Engine</span></a>
                </span>
            </span>

          
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>871</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>UE4中提供了一套非常成熟的INI文件配置机制，引擎中也使用了ini作为引擎和项目的配置文件。本篇文章来简单分析一下引擎中GConfig的加载。</p>
<a id="more"></a>

<p>UE中定义了一堆的全局ini：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Runtime/Core/Private/Misc/CoreGlobals.cpp</span></span><br><span class="line">FString       GEngineIni;                         <span class="comment">/* Engine ini filename */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** Editor ini file locations - stored per engine version (shared across all projects). Migrated between versions on first run. */</span></span><br><span class="line">FString       GEditorIni;                         <span class="comment">/* Editor ini filename */</span></span><br><span class="line">FString       GEditorKeyBindingsIni;                    <span class="comment">/* Editor Key Bindings ini file */</span></span><br><span class="line">FString       GEditorLayoutIni;                     <span class="comment">/* Editor UI Layout ini filename */</span></span><br><span class="line">FString       GEditorSettingsIni;                     <span class="comment">/* Editor Settings ini filename */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** Editor per-project ini files - stored per project. */</span></span><br><span class="line">FString       GEditorPerProjectIni;                   <span class="comment">/* Editor User Settings ini filename */</span></span><br><span class="line"></span><br><span class="line">FString       GCompatIni;</span><br><span class="line">FString       GLightmassIni;                        <span class="comment">/* Lightmass settings ini filename */</span></span><br><span class="line">FString       GScalabilityIni;                      <span class="comment">/* Scalability settings ini filename */</span></span><br><span class="line">FString       GHardwareIni;                       <span class="comment">/* Hardware ini filename */</span></span><br><span class="line">FString       GInputIni;                          <span class="comment">/* Input ini filename */</span></span><br><span class="line">FString       GGameIni;                         <span class="comment">/* Game ini filename */</span></span><br><span class="line">FString       GGameUserSettingsIni;                   <span class="comment">/* User Game Settings ini filename */</span></span><br></pre></td></tr></table></figure>
<p>但是并没有直接硬编码指定ini是在哪里的，其加载的过程为：在<code>FEngineLoop::AppInit</code>(LaunchEngineLoop.cpp)中通过调用<code>FConfigCacheIni::InitializeConfigSystem</code>来执行加载ini文件，其定义在<code>ConfigCacheIni.cpp</code>：</p>
<h3 id="FConfigCacheIni-InitializeConfigSystem"><a href="#FConfigCacheIni-InitializeConfigSystem" class="headerlink" title="FConfigCacheIni::InitializeConfigSystem"></a>FConfigCacheIni::InitializeConfigSystem</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// --------------------------------</span></span><br><span class="line"><span class="comment">// # FConfigCacheIni::InitializeConfigSystem declaration</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Creates GConfig, loads the standard global ini files (Engine, Editor, etc),</span></span><br><span class="line"><span class="comment"> * fills out GEngineIni, etc. and marks GConfig as ready for use</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">InitializeConfigSystem</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// --------------------------------</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">FConfigCacheIni::InitializeConfigSystem</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// Perform any upgrade we need before we load any configuration files</span></span><br><span class="line">  FConfigManifest::UpgradeFromPreviousVersions();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// create GConfig</span></span><br><span class="line">  GConfig = <span class="keyword">new</span> FConfigCacheIni(EConfigCacheType::DiskBacked);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// load the main .ini files (unless we&#x27;re running a program or a gameless UE4Editor.exe, DefaultEngine.ini is required).</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">bool</span> bIsGamelessExe = !FApp::HasProjectName();</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">bool</span> bDefaultEngineIniRequired = !bIsGamelessExe &amp;&amp; (GIsGameAgnosticExe || FApp::IsProjectNameEmpty());</span><br><span class="line">  <span class="keyword">bool</span> bEngineConfigCreated = FConfigCacheIni::LoadGlobalIniFile(GEngineIni, TEXT(<span class="string">&quot;Engine&quot;</span>), <span class="literal">nullptr</span>, bDefaultEngineIniRequired);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( !bIsGamelessExe )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Now check and see if our game is correct if this is a game agnostic binary</span></span><br><span class="line">    <span class="keyword">if</span> (GIsGameAgnosticExe &amp;&amp; !bEngineConfigCreated)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">const</span> FText AbsolutePath = FText::FromString( IFileManager::Get().ConvertToAbsolutePathForExternalAppForRead(*FPaths::GetPath(GEngineIni)) );</span><br><span class="line">      <span class="comment">//@todo this is too early to localize</span></span><br><span class="line">      <span class="keyword">const</span> FText Message = FText::Format( NSLOCTEXT(<span class="string">&quot;Core&quot;</span>, <span class="string">&quot;FirstCmdArgMustBeGameName&quot;</span>, <span class="string">&quot;&#x27;&#123;0&#125;&#x27; must exist and contain a DefaultEngine.ini.&quot;</span>), AbsolutePath );</span><br><span class="line">      <span class="keyword">if</span> (!GIsBuildMachine)</span><br><span class="line">      &#123;</span><br><span class="line">        FMessageDialog::Open(EAppMsgType::Ok, Message);</span><br><span class="line">      &#125;</span><br><span class="line">      FApp::SetProjectName(TEXT(<span class="string">&quot;&quot;</span>)); <span class="comment">// this disables part of the crash reporter to avoid writing log files to a bogus directory</span></span><br><span class="line">      <span class="keyword">if</span> (!GIsBuildMachine)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      UE_LOG(LogInit, Fatal,TEXT(<span class="string">&quot;%s&quot;</span>), *Message.ToString());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  FConfigCacheIni::LoadGlobalIniFile(GGameIni, TEXT(<span class="string">&quot;Game&quot;</span>));</span><br><span class="line">  FConfigCacheIni::LoadGlobalIniFile(GInputIni, TEXT(<span class="string">&quot;Input&quot;</span>));</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> WITH_EDITOR</span></span><br><span class="line">  <span class="comment">// load some editor specific .ini files</span></span><br><span class="line"></span><br><span class="line">  FConfigCacheIni::LoadGlobalIniFile(GEditorIni, TEXT(<span class="string">&quot;Editor&quot;</span>));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Upgrade editor user settings before loading the editor per project user settings</span></span><br><span class="line">  FConfigManifest::MigrateEditorUserSettings();</span><br><span class="line">  FConfigCacheIni::LoadGlobalIniFile(GEditorPerProjectIni, TEXT(<span class="string">&quot;EditorPerProjectUserSettings&quot;</span>));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Project agnostic editor ini files</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> FString EditorSettingsDir = FPaths::Combine(*FPaths::GameAgnosticSavedDir(), TEXT(<span class="string">&quot;Config&quot;</span>)) + TEXT(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">  FConfigCacheIni::LoadGlobalIniFile(GEditorSettingsIni, TEXT(<span class="string">&quot;EditorSettings&quot;</span>), <span class="literal">nullptr</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">true</span>, *EditorSettingsDir);</span><br><span class="line">  FConfigCacheIni::LoadGlobalIniFile(GEditorLayoutIni, TEXT(<span class="string">&quot;EditorLayout&quot;</span>), <span class="literal">nullptr</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">true</span>, *EditorSettingsDir);</span><br><span class="line">  FConfigCacheIni::LoadGlobalIniFile(GEditorKeyBindingsIni, TEXT(<span class="string">&quot;EditorKeyBindings&quot;</span>), <span class="literal">nullptr</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">true</span>, *EditorSettingsDir);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> PLATFORM_DESKTOP</span></span><br><span class="line">  <span class="comment">// load some desktop only .ini files</span></span><br><span class="line">  FConfigCacheIni::LoadGlobalIniFile(GCompatIni, TEXT(<span class="string">&quot;Compat&quot;</span>));</span><br><span class="line">  FConfigCacheIni::LoadGlobalIniFile(GLightmassIni, TEXT(<span class="string">&quot;Lightmass&quot;</span>));</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Load scalability settings.</span></span><br><span class="line">  FConfigCacheIni::LoadGlobalIniFile(GScalabilityIni, TEXT(<span class="string">&quot;Scalability&quot;</span>));</span><br><span class="line">  <span class="comment">// Load driver blacklist</span></span><br><span class="line">  FConfigCacheIni::LoadGlobalIniFile(GHardwareIni, TEXT(<span class="string">&quot;Hardware&quot;</span>));</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Load user game settings .ini, allowing merging. This also updates the user .ini if necessary.</span></span><br><span class="line">  FConfigCacheIni::LoadGlobalIniFile(GGameUserSettingsIni, TEXT(<span class="string">&quot;GameUserSettings&quot;</span>));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// now we can make use of GConfig</span></span><br><span class="line">  GConfig-&gt;bIsReadyForUse = <span class="literal">true</span>;</span><br><span class="line">  FCoreDelegates::ConfigReadyForUse.Broadcast();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="FConfigCacheIni-LoadGlobalIniFile"><a href="#FConfigCacheIni-LoadGlobalIniFile" class="headerlink" title="FConfigCacheIni::LoadGlobalIniFile"></a>FConfigCacheIni::LoadGlobalIniFile</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// --------------------------------</span></span><br><span class="line"><span class="comment">// # FConfigCacheIni::LoadGlobalIniFile declaration</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Loads and generates a destination ini file and adds it to GConfig:</span></span><br><span class="line"><span class="comment"> *   - Looking on commandline for override source/dest .ini filenames</span></span><br><span class="line"><span class="comment"> *   - Generating the name for the engine to refer to the ini</span></span><br><span class="line"><span class="comment"> *   - Loading a source .ini file hierarchy</span></span><br><span class="line"><span class="comment"> *   - Filling out an FConfigFile</span></span><br><span class="line"><span class="comment"> *   - Save the generated ini</span></span><br><span class="line"><span class="comment"> *   - Adds the FConfigFile to GConfig</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param FinalIniFilename The output name of the generated .ini file (in Game\Saved\Config)</span></span><br><span class="line"><span class="comment"> * @param BaseIniName The &quot;base&quot; ini name, with no extension (ie, Engine, Game, etc)</span></span><br><span class="line"><span class="comment"> * @param Platform The platform to load the .ini for (if NULL, uses current)</span></span><br><span class="line"><span class="comment"> * @param bForceReload If true, the destination .in will be regenerated from the source, otherwise this will only process if the dest isn&#x27;t in GConfig</span></span><br><span class="line"><span class="comment"> * @param bRequireDefaultIni If true, the Default*.ini file is required to exist when generating the final ini file.</span></span><br><span class="line"><span class="comment"> * @param bAllowGeneratedIniWhenCooked If true, the engine will attempt to load the generated/user INI file when loading cooked games</span></span><br><span class="line"><span class="comment"> * @param GeneratedConfigDir The location where generated config files are made.</span></span><br><span class="line"><span class="comment"> * @return true if the final ini was created successfully.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">LoadGlobalIniFile</span><span class="params">(FString&amp; FinalIniFilename, <span class="keyword">const</span> TCHAR* BaseIniName, <span class="keyword">const</span> TCHAR* Platform=<span class="literal">NULL</span>, <span class="keyword">bool</span> bForceReload=<span class="literal">false</span>, <span class="keyword">bool</span> bRequireDefaultIni=<span class="literal">false</span>, <span class="keyword">bool</span> bAllowGeneratedIniWhenCooked=<span class="literal">true</span>, <span class="keyword">const</span> TCHAR* GeneratedConfigDir = *FPaths::GeneratedConfigDir())</span></span>;</span><br><span class="line"><span class="comment">// --------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">FConfigCacheIni::LoadGlobalIniFile</span><span class="params">(FString&amp; FinalIniFilename, <span class="keyword">const</span> TCHAR* BaseIniName, <span class="keyword">const</span> TCHAR* Platform, <span class="keyword">bool</span> bForceReload, <span class="keyword">bool</span> bRequireDefaultIni, <span class="keyword">bool</span> bAllowGeneratedIniWhenCooked, <span class="keyword">const</span> TCHAR* GeneratedConfigDir)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// figure out where the end ini file is</span></span><br><span class="line">  FinalIniFilename = GetDestIniFilename(BaseIniName, Platform, GeneratedConfigDir);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Start the loading process for the remote config file when appropriate</span></span><br><span class="line">  <span class="keyword">if</span> (FRemoteConfig::Get()-&gt;ShouldReadRemoteFile(*FinalIniFilename))</span><br><span class="line">  &#123;</span><br><span class="line">    FRemoteConfig::Get()-&gt;Read(*FinalIniFilename, BaseIniName);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  FRemoteConfigAsyncIOInfo* RemoteInfo = FRemoteConfig::Get()-&gt;FindConfig(*FinalIniFilename);</span><br><span class="line">  <span class="keyword">if</span> (RemoteInfo &amp;&amp; (!RemoteInfo-&gt;bWasProcessed || !FRemoteConfig::Get()-&gt;IsFinished(*FinalIniFilename)))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Defer processing this remote config file to until it has finish its IO operation</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// need to check to see if the file already exists in the GConfigManager&#x27;s cache</span></span><br><span class="line">  <span class="comment">// if it does exist then we are done, nothing else to do</span></span><br><span class="line">  <span class="keyword">if</span> (!bForceReload &amp;&amp; GConfig-&gt;FindConfigFile(*FinalIniFilename) != <span class="literal">nullptr</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//UE_LOG(LogConfig, Log,  TEXT( &quot;Request to load a config file that was already loaded: %s&quot; ), GeneratedIniFile );</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// make a new entry in GConfig (overwriting what&#x27;s already there)</span></span><br><span class="line">  FConfigFile&amp; NewConfigFile = GConfig-&gt;Add(FinalIniFilename, FConfigFile());</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> LoadExternalIniFile(NewConfigFile, BaseIniName, *FPaths::EngineConfigDir(), *FPaths::SourceConfigDir(), <span class="literal">true</span>, Platform, bForceReload, <span class="literal">true</span>, bAllowGeneratedIniWhenCooked, GeneratedConfigDir);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="FConfigCacheIni-LoadLocalIniFile"><a href="#FConfigCacheIni-LoadLocalIniFile" class="headerlink" title="FConfigCacheIni::LoadLocalIniFile"></a>FConfigCacheIni::LoadLocalIniFile</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// --------------------------------</span></span><br><span class="line"><span class="comment">// # FConfigCacheIni::LoadLocalIniFile declaration</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Load an ini file directly into an FConfigFile, and nothing is written to GConfig or disk. </span></span><br><span class="line"><span class="comment"> * The passed in .ini name can be a &quot;base&quot; (Engine, Game) which will be modified by platform and/or commandline override,</span></span><br><span class="line"><span class="comment"> * or it can be a full ini filenname (ie WrangleContent) loaded from the Source config directory</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param ConfigFile The output object to fill</span></span><br><span class="line"><span class="comment"> * @param IniName Either a Base ini name (Engine) or a full ini name (WrangleContent). NO PATH OR EXTENSION SHOULD BE USED!</span></span><br><span class="line"><span class="comment"> * @param bIsBaseIniName true if IniName is a Base name, which can be overridden on commandline, etc.</span></span><br><span class="line"><span class="comment"> * @param Platform The platform to use for Base ini names, NULL means to use the current platform</span></span><br><span class="line"><span class="comment"> * @param bForceReload force reload the ini file from disk this is required if you make changes to the ini file not using the config system as the hierarchy cache will not be updated in this case</span></span><br><span class="line"><span class="comment"> * @return true if the ini file was loaded successfully</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">LoadLocalIniFile</span><span class="params">(FConfigFile&amp; ConfigFile, <span class="keyword">const</span> TCHAR* IniName, <span class="keyword">bool</span> bIsBaseIniName, <span class="keyword">const</span> TCHAR* Platform=<span class="literal">NULL</span>, <span class="keyword">bool</span> bForceReload=<span class="literal">false</span>)</span></span>;</span><br><span class="line"><span class="comment">// --------------------------------</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">FConfigCacheIni::LoadLocalIniFile</span><span class="params">(FConfigFile&amp; ConfigFile, <span class="keyword">const</span> TCHAR* IniName, <span class="keyword">bool</span> bIsBaseIniName, <span class="keyword">const</span> TCHAR* Platform, <span class="keyword">bool</span> bForceReload )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  DECLARE_SCOPE_CYCLE_COUNTER( TEXT( <span class="string">&quot;FConfigCacheIni::LoadLocalIniFile&quot;</span> ), STAT_FConfigCacheIni_LoadLocalIniFile, STATGROUP_LoadTime );</span><br><span class="line"></span><br><span class="line">  FString EngineConfigDir = FPaths::EngineConfigDir();</span><br><span class="line">  FString SourceConfigDir = FPaths::SourceConfigDir();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (bIsBaseIniName)</span><br><span class="line">  &#123;</span><br><span class="line">    FConfigFile* BaseConfig = GConfig-&gt;FindConfigFileWithBaseName(IniName);</span><br><span class="line">    <span class="comment">// If base ini, try to use an existing GConfig file to set the config directories instead of assuming defaults</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (BaseConfig)</span><br><span class="line">    &#123;</span><br><span class="line">      FIniFilename* EngineFilename = BaseConfig-&gt;SourceIniHierarchy.Find(EConfigFileHierarchy::EngineDirBase);</span><br><span class="line">      <span class="keyword">if</span> (EngineFilename)</span><br><span class="line">      &#123;</span><br><span class="line">        EngineConfigDir = FPaths::GetPath(EngineFilename-&gt;Filename) + TEXT(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      FIniFilename* GameFilename = BaseConfig-&gt;SourceIniHierarchy.Find(EConfigFileHierarchy::GameDirDefault);</span><br><span class="line">      <span class="keyword">if</span> (GameFilename)</span><br><span class="line">      &#123;</span><br><span class="line">        SourceConfigDir = FPaths::GetPath(GameFilename-&gt;Filename) + TEXT(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> LoadExternalIniFile(ConfigFile, IniName, *EngineConfigDir, *SourceConfigDir, bIsBaseIniName, Platform, bForceReload, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="FConfigCacheIni-LoadExternalIniFile"><a href="#FConfigCacheIni-LoadExternalIniFile" class="headerlink" title="FConfigCacheIni::LoadExternalIniFile"></a>FConfigCacheIni::LoadExternalIniFile</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// --------------------------------</span></span><br><span class="line"><span class="comment">// # FConfigCacheIni::LoadExternalIniFile declaration</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Load an ini file directly into an FConfigFile from the specified config folders, optionally writing to disk. </span></span><br><span class="line"><span class="comment"> * The passed in .ini name can be a &quot;base&quot; (Engine, Game) which will be modified by platform and/or commandline override,</span></span><br><span class="line"><span class="comment"> * or it can be a full ini filenname (ie WrangleContent) loaded from the Source config directory</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param ConfigFile The output object to fill</span></span><br><span class="line"><span class="comment"> * @param IniName Either a Base ini name (Engine) or a full ini name (WrangleContent). NO PATH OR EXTENSION SHOULD BE USED!</span></span><br><span class="line"><span class="comment"> * @param EngineConfigDir Engine config directory.</span></span><br><span class="line"><span class="comment"> * @param SourceConfigDir Game config directory.</span></span><br><span class="line"><span class="comment"> * @param bIsBaseIniName true if IniName is a Base name, which can be overridden on commandline, etc.</span></span><br><span class="line"><span class="comment"> * @param Platform The platform to use for Base ini names</span></span><br><span class="line"><span class="comment"> * @param bForceReload force reload the ini file from disk this is required if you make changes to the ini file not using the config system as the hierarchy cache will not be updated in this case</span></span><br><span class="line"><span class="comment"> * @param bWriteDestIni write out a destination ini file to the Saved folder, only valid if bIsBaseIniName is true</span></span><br><span class="line"><span class="comment"> * @param bAllowGeneratedIniWhenCooked If true, the engine will attempt to load the generated/user INI file when loading cooked games</span></span><br><span class="line"><span class="comment"> * @param GeneratedConfigDir The location where generated config files are made.</span></span><br><span class="line"><span class="comment"> * @return true if the ini file was loaded successfully</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">LoadExternalIniFile</span><span class="params">(FConfigFile&amp; ConfigFile, <span class="keyword">const</span> TCHAR* IniName, <span class="keyword">const</span> TCHAR* EngineConfigDir, <span class="keyword">const</span> TCHAR* SourceConfigDir, <span class="keyword">bool</span> bIsBaseIniName, <span class="keyword">const</span> TCHAR* Platform=<span class="literal">NULL</span>, <span class="keyword">bool</span> bForceReload=<span class="literal">false</span>, <span class="keyword">bool</span> bWriteDestIni=<span class="literal">false</span>, <span class="keyword">bool</span> bAllowGeneratedIniWhenCooked = <span class="literal">true</span>, <span class="keyword">const</span> TCHAR* GeneratedConfigDir = *FPaths::GeneratedConfigDir())</span></span>;</span><br><span class="line"><span class="comment">// --------------------------------</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">FConfigCacheIni::LoadExternalIniFile</span><span class="params">(FConfigFile&amp; ConfigFile, <span class="keyword">const</span> TCHAR* IniName, <span class="keyword">const</span> TCHAR* EngineConfigDir, <span class="keyword">const</span> TCHAR* SourceConfigDir, <span class="keyword">bool</span> bIsBaseIniName, <span class="keyword">const</span> TCHAR* Platform, <span class="keyword">bool</span> bForceReload, <span class="keyword">bool</span> bWriteDestIni, <span class="keyword">bool</span> bAllowGeneratedIniWhenCooked, <span class="keyword">const</span> TCHAR* GeneratedConfigDir)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// if bIsBaseIniName is false, that means the .ini is a ready-to-go .ini file, and just needs to be loaded into the FConfigFile</span></span><br><span class="line">  <span class="keyword">if</span> (!bIsBaseIniName)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// generate path to the .ini file (not a Default ini, IniName is the complete name of the file, without path)</span></span><br><span class="line">    FString SourceIniFilename = FString::Printf(TEXT(<span class="string">&quot;%s/%s.ini&quot;</span>), SourceConfigDir, IniName);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// load the .ini file straight up</span></span><br><span class="line">    LoadAnIniFile(*SourceIniFilename, ConfigFile);</span><br><span class="line"></span><br><span class="line">    ConfigFile.Name = IniName;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    FString DestIniFilename = GetDestIniFilename(IniName, Platform, GeneratedConfigDir);</span><br><span class="line"></span><br><span class="line">    GetSourceIniHierarchyFilenames( IniName, Platform, EngineConfigDir, SourceConfigDir, ConfigFile.SourceIniHierarchy, <span class="literal">false</span> );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( bForceReload )</span><br><span class="line">    &#123;</span><br><span class="line">      ClearHierarchyCache( IniName );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Keep a record of the original settings</span></span><br><span class="line">    ConfigFile.SourceConfigFile = <span class="keyword">new</span> FConfigFile();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// now generate and make sure it&#x27;s up to date (using IniName as a Base for an ini filename)</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">bool</span> bAllowGeneratedINIs = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">bool</span> bNeedsWrite = GenerateDestIniFile(ConfigFile, DestIniFilename, ConfigFile.SourceIniHierarchy, bAllowGeneratedIniWhenCooked, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    ConfigFile.Name = IniName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// don&#x27;t write anything to disk in cooked builds - we will always use re-generated INI files anyway.</span></span><br><span class="line">    <span class="keyword">if</span> (bWriteDestIni &amp;&amp; (!FPlatformProperties::RequiresCookedData() || bAllowGeneratedIniWhenCooked)</span><br><span class="line">      <span class="comment">// We shouldn&#x27;t save config files when in multiprocess mode,</span></span><br><span class="line">      <span class="comment">// otherwise we get file contention in XGE shader builds.</span></span><br><span class="line">      &amp;&amp; !FParse::Param(FCommandLine::Get(), TEXT(<span class="string">&quot;Multiprocess&quot;</span>)))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// Check the config system for any changes made to defaults and propagate through to the saved.</span></span><br><span class="line">      ConfigFile.ProcessSourceAndCheckAgainstBackup();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (bNeedsWrite)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// if it was dirtied during the above function, save it out now</span></span><br><span class="line">        ConfigFile.Write(DestIniFilename);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// GenerateDestIniFile returns true if nothing is loaded, so check if we actually loaded something</span></span><br><span class="line">  <span class="keyword">return</span> ConfigFile.Num() &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个函数中最重要的部分就是调用了<code>GetSourceIniHierarchyFilenames</code>，它把当前传入的baseName的ini在Engine和项目下的所有ini文件都收集了起来。</p>
<p>这就是为什么我们看到其实GConfig中很多都是<code>Saved/Config</code>下的ini，里面内容是空的，但是我们怎么查到项目里的设置的呢？这是因为UE把这么多个ini合并了：</p>
<p><img data-src="ue4-gather-ini-source-ini-hierachy.webp"></p>
<p>这些ini的的内容都会加载进来。</p>
<h3 id="GetDestIniFilename"><a href="#GetDestIniFilename" class="headerlink" title="GetDestIniFilename"></a>GetDestIniFilename</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Runtime/Source/Core/Private/Misc/ConfigCacheIni.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Calculates the name of a dest (generated) .ini file for a given base (ie Engine, Game, etc)</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param IniBaseName Base name of the .ini (Engine, Game)</span></span><br><span class="line"><span class="comment"> * @param PlatformName Name of the platform to get the .ini path for (nullptr means to use the current platform)</span></span><br><span class="line"><span class="comment"> * @param GeneratedConfigDir The base folder that will contain the generated config files.</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @return Standardized .ini filename</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> FString <span class="title">GetDestIniFilename</span><span class="params">(<span class="keyword">const</span> TCHAR* BaseIniName, <span class="keyword">const</span> TCHAR* PlatformName, <span class="keyword">const</span> TCHAR* GeneratedConfigDir)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// figure out what to look for on the commandline for an override</span></span><br><span class="line">  FString CommandLineSwitch = FString::Printf(TEXT(<span class="string">&quot;%sINI=&quot;</span>), BaseIniName);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// if it&#x27;s not found on the commandline, then generate it</span></span><br><span class="line">  FString IniFilename;</span><br><span class="line">  <span class="keyword">if</span> (FParse::Value(FCommandLine::Get(), *CommandLineSwitch, IniFilename) == <span class="literal">false</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="function">FString <span class="title">Name</span><span class="params">(PlatformName ? PlatformName : ANSI_TO_TCHAR(FPlatformProperties::PlatformName()))</span></span>;</span><br><span class="line"></span><br><span class="line">    FString BaseIniNameString = BaseIniName;</span><br><span class="line">    <span class="keyword">if</span> (BaseIniNameString.Contains(GeneratedConfigDir))</span><br><span class="line">    &#123;</span><br><span class="line">      IniFilename = BaseIniNameString;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// put it all together</span></span><br><span class="line">      IniFilename = FString::Printf(TEXT(<span class="string">&quot;%s%s/%s.ini&quot;</span>), GeneratedConfigDir, *Name, BaseIniName);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// standardize it!</span></span><br><span class="line">  FPaths::MakeStandardFilename(IniFilename);</span><br><span class="line">  <span class="keyword">return</span> IniFilename;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>而<code>FPaths::GeneratedConfigDir</code>获取的路径是当前项目的<code>Saved</code>下的Config：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Paths.cpp</span></span><br><span class="line"><span class="function">FString <span class="title">FPaths::GeneratedConfigDir</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> PLATFORM_MAC</span></span><br><span class="line">  <span class="keyword">return</span> FPlatformProcess::UserPreferencesDir();</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">  <span class="keyword">return</span> FPaths::ProjectSavedDir() + TEXT(<span class="string">&quot;Config/&quot;</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>即在Windows平台上项目启动时创建的全局<code>G*Ini</code>文件读取的都是<code>Saved/Config/Windows</code>下的<code>.ini</code>。<br>而且在<code>GetDestIniFilename</code>的实现中也可以看到，<code>G*Ini</code>的配置也是可以从CommandLine传入的，可以替换掉默认的<code>Saved/Config/Platform</code>下的ini:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 使用指定的Engine.ini</span><br><span class="line">UE4Editor.exe uprojectPath -EngineINI=<span class="string">&quot;D:\\CustomEngine.ini&quot;</span></span><br></pre></td></tr></table></figure>
<p><img data-src="ue-pass-custom-globalconfig-by-commandline.webp"><br><img data-src="ue-pass-custom-globalconfig-by-commandline-2.webp"></p>
<p><strong>扩展阅读</strong></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/en-US/Programming/Basics/ConfigurationFiles/index.html">ConfigurationFiles</a></li>
<li><a target="_blank" rel="noopener" href="https://wiki.unrealengine.com/Config_Files,_Read_%26_Write_to_Config_Files">Config Files, Read &amp; Write to Config Files</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.ch-wind.com/ue4-config-usage/">UE4中Config的使用</a></li>
</ul>

    </div>

    
    
        
        
          
            <blockquote class="blockquote-center">
              
                全文完，若有不足之处请评论指正。
              
            <br/>
            
                <div class="qr-code" onclick="return false">
                    <script src="/js/qrcode.min.js"></script>
                    <div id="qrcode">
                      
                        <img src="https://imzlp.com/images/wechat-qrcode.webp">
                      
                    <p>微信扫描二维码，关注我的公众号。</p>
                    </div>
                </div>
            
            </blockquote>
          
        

        
          <div class="postCopyright" style="clear:both;">
             <span>本文标题:</span><a href="/posts/2386/" target="_blank">UE代码分析:GConfig的加载</a><br/>
             <span>文章作者:</span><a href="/about" target="_blank" title="查看 查利鹏 的资料">查利鹏</a><br/>
             <span>发布时间:</span>2019年05月27日 22时57分<br/>
             
             <span>本文字数:</span><span class="page-count">本文一共有871字</span><br/>
             
             <span>原始链接:</span><a href="/posts/2386/" target="_blank" title="UE代码分析:GConfig的加载">https://imzlp.com/posts/2386/</a>
             <span class="copy-path" data-clipboard-text="原文链接: https://imzlp.com/posts/2386/ 作者: 查利鹏" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
             <script src="/js/jquery.min.js"></script>
             <script src="/js/clipboard.min.js"></script>
             <script> var clipboard = new Clipboard('.copy-path'); </script>
             <br/>
             
             <span>许可协议:</span><i class="fab fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="Attribution-NonCommercial-ShareAlike 4.0 International">CC BY-NC-SA 4.0</a><br/>
             
             <span>转载请保留原文链接及作者信息，谢谢！</span>
          </div>
        
    
        
  <div class="reward-container">
    <div>您的捐赠将鼓励我继续创作！</div>
    <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
      打赏
    </button>
    <div id="qr" style="display: none;">
        
        <div style="display: inline-block;">
          <img src="/images/reward/wechatpay.webp" alt="查利鹏 微信支付">
          <p>微信支付</p>
        </div>
        
        <div style="display: inline-block;">
          <img src="/images/reward/alipay.webp" alt="查利鹏 支付宝">
          <p>支付宝</p>
        </div>

    </div>
  </div>



      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Unreal-Engine/" rel="tag"># Unreal Engine</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/posts/3231/" rel="prev" title="UE4接入SteamSDK及相关资料">
      <i class="fa fa-chevron-left"></i> UE4接入SteamSDK及相关资料
    </a></div>
      <div class="post-nav-item">
    <a href="/posts/25331/" rel="next" title="UE4开发的问题笔记和资料辑录">
      UE4开发的问题笔记和资料辑录 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
      <div class="tabs tabs-comment">
        <ul class="nav-tabs">
            <li class="tab"><a href="#comment-utteranc">utteranc</a></li>
            <li class="tab"><a href="#comment-valine">valine</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane utteranc" id="comment-utteranc">
              
  
  <div class="comments">
  <script src="https://utteranc.es/client.js" repo="hxhb/blog-comments" issue-term="title" theme="github-light" crossorigin="anonymous" async></script>
  </div>
  
  
            </div>
            <div class="tab-pane valine" id="comment-valine">
              <div class="comments" id="valine-comments"></div>
            </div>
        </div>
      </div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#FConfigCacheIni-InitializeConfigSystem"><span class="nav-number">1.</span> <span class="nav-text">FConfigCacheIni::InitializeConfigSystem</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FConfigCacheIni-LoadGlobalIniFile"><span class="nav-number">2.</span> <span class="nav-text">FConfigCacheIni::LoadGlobalIniFile</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FConfigCacheIni-LoadLocalIniFile"><span class="nav-number">3.</span> <span class="nav-text">FConfigCacheIni::LoadLocalIniFile</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FConfigCacheIni-LoadExternalIniFile"><span class="nav-number">4.</span> <span class="nav-text">FConfigCacheIni::LoadExternalIniFile</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GetDestIniFilename"><span class="nav-number">5.</span> <span class="nav-text">GetDestIniFilename</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="查利鹏"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">查利鹏</p>
  <div class="site-description" itemprop="description">每一篇文章都是一个成长的过程。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">141</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">58</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">130</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/hxhb" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hxhb" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/imzlp" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;imzlp" rel="noopener" target="_blank"><i class="fa fa-custom zhihu fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/images/wechat-qrcode-offical.webp" title="微信公众号 → &#x2F;images&#x2F;wechat-qrcode-offical.webp"><i class="fab fa-weixin fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:visionsmile@gmail.com" title="E-Mail → mailto:visionsmile@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://docs.imzlp.com/" title="https:&#x2F;&#x2F;docs.imzlp.com&#x2F;" rel="noopener" target="_blank">TechDocuments</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://linux.imzlp.com/" title="https:&#x2F;&#x2F;linux.imzlp.com&#x2F;" rel="noopener" target="_blank">LinuxCommands</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://books.imzlp.com/" title="https:&#x2F;&#x2F;books.imzlp.com&#x2F;" rel="noopener" target="_blank">IT Books Search</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://soft.imzlp.com/" title="https:&#x2F;&#x2F;soft.imzlp.com&#x2F;" rel="noopener" target="_blank">Software Search</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://ue4coderules.imzlp.com/" title="https:&#x2F;&#x2F;ue4coderules.imzlp.com&#x2F;" rel="noopener" target="_blank">UE4 Code Rules</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://consolehelp.imzlp.com/" title="https:&#x2F;&#x2F;consolehelp.imzlp.com&#x2F;" rel="noopener" target="_blank">UE4 Console Help</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://ue4wiki.imzlp.com/" title="https:&#x2F;&#x2F;ue4wiki.imzlp.com&#x2F;" rel="noopener" target="_blank">UE4 Wiki</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://ue5lab.com/#/" title="https:&#x2F;&#x2F;ue5lab.com&#x2F;#&#x2F;" rel="noopener" target="_blank">UE5 Lab</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">粤ICP备2021027036号 </a>
  </div>

<div class="copyright">
  
  &copy; 2014 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">查利鹏</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">543k</span>
</div>
  <div class="powered-by-other">
    
	    <center>Github Pages | Actions | NeXT | Cloudflare | Hexo Deploy</center>
      
  </div>

<script>
function checkWebp(callback) {
    var img = new Image();
    img.onload = function () { callback((img.width > 0) && (img.height > 0)); };
    img.onerror = function () { callback(false); };
    img.src = 'data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA';
}
function showImage(useWebp) {
    var imgs = [].slice.call(document.querySelectorAll('img'));
    imgs.forEach(function (e) {
        if (!useWebp) {
            var src = e.getAttribute('data-src')
            src = src.replace(/\.webp$/, '.png');
            e.setAttribute('data-src', src);
        }
    });
}
checkWebp(showImage);
</script>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>




  




  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>


<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

  
  <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://imzlp.com/posts/2386/',]
      });
      });
  </script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'oCE6RMVkVoi5MgUhvFsn1EvV-gzGzoHsz',
      appKey     : 'K9SOaNYJ8PV6xaoFggWG5xvv',
      placeholder: "留下点什么吧~",
      avatar     : 'retro',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
